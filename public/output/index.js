import e from"axios";import t from"stripe";let o=()=>{let e=document.querySelector(".alert");e&&e.parentElement.removeChild(e)},a=(e,t,a=7)=>{o();let s=`<div class="alert alert--${e}">${t}</div>`;document.body.insertAdjacentHTML("afterbegin",s),window.setTimeout(o,1e3*a)},s=async(t,o)=>{try{let s=await e({method:"POST",url:"/api/v1/users/login",data:{email:t,password:o}});"success"===s.data.status&&(a("success","Logged in successfully"),window.setTimeout(()=>{location.assign("/")},1500))}catch(e){a("error",e.response.data.message)}},n=async()=>{try{let t=await e({method:"GET",url:"/api/v1/users/logout"});"success"===t.data.status&&(a("success","Logged out successfully"),window.location.reload(!0))}catch(e){a("error","Error logging out! Try again."),console.log(e.message)}},r=async(t,o)=>{try{let s=await e({method:"PATCH",url:"password"===o?"/api/v1/users/updateMyPassword":"/api/v1/users/updateMe",data:t});"success"===s.data.status&&a("success","Data updated successfully.")}catch(e){a("error",e.response.data.message)}};t("pk_test_51PvxKrDsc8K2y9kbCrEJxMQENqoSwUiI6IKPPE1zdPtuhLG0vONQCJ5hLm3HaQzkuHVY1T3lySTlGuYDnBo0fweM00ClUznmJL");let d=async t=>{try{let o=await e(`/api/v1/bookings/checkout-session/${t}`);window.location.href=o.data.session.url}catch(e){console.log(e),a("error",e)}},c=document.getElementById("map"),l=document.querySelector(".form--login"),u=document.querySelector(".nav__el--logout"),i=document.querySelector(".form-user-data"),m=document.querySelector(".form-user-settings"),p=document.getElementById("book-tour");c&&(e=>{let t=L.map("map",{scrollWheelZoom:!1});L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{maxZoom:19}).addTo(t);let o=L.latLngBounds();e.forEach(e=>{let a=[e.coordinates[1],e.coordinates[0]],s=L.icon({iconUrl:"/img/pin.png",iconSize:[32,40],iconAnchor:[22,94]});L.marker(a,{icon:s}).addTo(t),L.popup(a,{content:`<p>Day ${e.day}: ${e.description}</p>`,offset:L.point(-5,-70)}).addTo(t),o.extend(a)}),t.fitBounds(o,{paddingTopLeft:[100,200],paddingBottomRight:[100,50]})})(JSON.parse(c.dataset.locations)),l&&l.addEventListener("submit",e=>{e.preventDefault(),s(document.getElementById("email").value,document.getElementById("password").value)}),u&&u.addEventListener("click",n),i&&i.addEventListener("submit",function(e){e.preventDefault();let t=new FormData;t.append("name",this.querySelector("input[name='name']").value),t.append("email",this.querySelector("input[name='email']").value),t.append("photo",document.getElementById("photo").files[0]),r(t,"data")}),m&&m.addEventListener("submit",async function(e){e.preventDefault(),document.querySelector(".btn--save-password").textContent="Updating...";let t=document.getElementById("password-current").value,o=document.getElementById("password").value,a=document.getElementById("password-confirm").value;await r({passwordCurrent:t,password:o,passwordConfirm:a},"password"),document.querySelector(".btn--save-password").textContent="Save password",document.getElementById("password-current").value="",document.getElementById("password").value="",document.getElementById("password-confirm").value=""}),p&&p.addEventListener("click",e=>{e.target.textContent="Processing...";let{tourId:t}=e.target.dataset;d(t),e.target.textContent="Book tour now!"});let g=document.body.dataset.alert;g&&a("success",g,20);