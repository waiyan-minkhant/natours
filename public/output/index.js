var e=require("axios"),t=require("stripe");function o(e){return e&&e.__esModule?e.default:e}const a=()=>{let e=document.querySelector(".alert");e&&e.parentElement.removeChild(e)},s=(e,t,o=7)=>{a();let s=`<div class="alert alert--${e}">${t}</div>`;document.body.insertAdjacentHTML("afterbegin",s),window.setTimeout(a,1e3*o)},n=async(t,a)=>{try{let n=await o(e)({method:"POST",url:"/api/v1/users/login",data:{email:t,password:a}});"success"===n.data.status&&(s("success","Logged in successfully"),window.setTimeout(()=>{location.assign("/")},1500))}catch(e){s("error",e.response.data.message)}},r=async()=>{try{let t=await o(e)({method:"GET",url:"/api/v1/users/logout"});"success"===t.data.status&&(s("success","Logged out successfully"),window.location.reload(!0))}catch(e){s("error","Error logging out! Try again."),console.log(e.message)}},d=async(t,a)=>{try{let n=await o(e)({method:"PATCH",url:"password"===a?"/api/v1/users/updateMyPassword":"/api/v1/users/updateMe",data:t});"success"===n.data.status&&s("success","Data updated successfully.")}catch(e){s("error",e.response.data.message)}};o(t)("pk_test_51PvxKrDsc8K2y9kbCrEJxMQENqoSwUiI6IKPPE1zdPtuhLG0vONQCJ5hLm3HaQzkuHVY1T3lySTlGuYDnBo0fweM00ClUznmJL");const c=async t=>{try{let a=await o(e)(`/api/v1/bookings/checkout-session/${t}`);window.location.href=a.data.session.url}catch(e){console.log(e),s("error",e)}},u=document.getElementById("map"),l=document.querySelector(".form--login"),i=document.querySelector(".nav__el--logout"),m=document.querySelector(".form-user-data"),p=document.querySelector(".form-user-settings"),g=document.getElementById("book-tour");u&&(e=>{let t=L.map("map",{scrollWheelZoom:!1});L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{maxZoom:19}).addTo(t);let o=L.latLngBounds();e.forEach(e=>{let a=[e.coordinates[1],e.coordinates[0]],s=L.icon({iconUrl:"/img/pin.png",iconSize:[32,40],iconAnchor:[22,94]});L.marker(a,{icon:s}).addTo(t),L.popup(a,{content:`<p>Day ${e.day}: ${e.description}</p>`,offset:L.point(-5,-70)}).addTo(t),o.extend(a)}),t.fitBounds(o,{paddingTopLeft:[100,200],paddingBottomRight:[100,50]})})(JSON.parse(u.dataset.locations)),l&&l.addEventListener("submit",e=>{e.preventDefault(),n(document.getElementById("email").value,document.getElementById("password").value)}),i&&i.addEventListener("click",r),m&&m.addEventListener("submit",function(e){e.preventDefault();let t=new FormData;t.append("name",this.querySelector("input[name='name']").value),t.append("email",this.querySelector("input[name='email']").value),t.append("photo",document.getElementById("photo").files[0]),d(t,"data")}),p&&p.addEventListener("submit",async function(e){e.preventDefault(),document.querySelector(".btn--save-password").textContent="Updating...";let t=document.getElementById("password-current").value,o=document.getElementById("password").value,a=document.getElementById("password-confirm").value;await d({passwordCurrent:t,password:o,passwordConfirm:a},"password"),document.querySelector(".btn--save-password").textContent="Save password",document.getElementById("password-current").value="",document.getElementById("password").value="",document.getElementById("password-confirm").value=""}),g&&g.addEventListener("click",e=>{e.target.textContent="Processing...";let{tourId:t}=e.target.dataset;c(t),e.target.textContent="Book tour now!"});const y=document.body.dataset.alert;y&&s("success",y,20);